name: Check File Changes

on:
  pull_request:
    branches:
      - main
      - staging
      - release

jobs:
  tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Check for changes in file
        run: |
          git fetch
          EVENT_DATA=$(cat $GITHUB_EVENT_PATH)
          TARGET_BRANCH_NAME=$(echo $EVENT_DATA | jq .pull_request.base.ref | tr -d '"')
          echo $TARGET_BRANCH_NAME
          DIFFRENCE_DIRECTORY="$(git diff "origin/$TARGET_BRANCH_NAME":src/main/resources/db/migration src/main/resources/db/migration)"
          echo "$DIFFRENCE_DIRECTORY"
          FILES_IN_TARGET_BRANCH="$(git ls-tree -r "origin/$TARGET_BRANCH_NAME" --name-only src/main/resources/db/migration)"
          echo "$FILES_IN_TARGET_BRANCH"
          echo "FILES IN LOCAL"
          FILES_IN_DIR="$(ls src/main/resources/db/migration)"
          echo "$FILES_IN_DIR"
          while IFS='' read -r line; do
          TIME_STAMP_IN_BRANCH+="$(echo $line | grep -o '[0-9]\{10\}')"
          done <<< "$FILES_IN_TARGET_BRANCH"
          echo $TIME_STAMP_IN_BRANCH
